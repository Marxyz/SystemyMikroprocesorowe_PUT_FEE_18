C51 COMPILER V9.59.0.0   MAIN                                                              12/04/2018 22:45:24 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Users\Arkadiusz\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT
                    -(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "aduc831.h"    //Definitions of ADuC831 registers name
   2          #include "stdint.h"     //Standard integers
   3          #include "stdfloat.h" //Standard float
   4          #include "IO.h"                         //Input/output definitions
   5          #include <stdlib.h>
   6          #define ca_Vref 5.0
   7          #define ca_Resolution 12
   8          #define ca_Maximum_Value ((0x000001ul<<ca_Resolution)-1)
   9          #define F_OSC 11058000
  10          #define pars 12
  11          #define t_resol 16
  12          #define OKRES 50
  13          
  14          #define Tx_Tau(dzielnik) (float)((float)dzielnik/F_OSC)
  15          #define Tx_N(czas_ms, dzielnik) (unsigned int)((float)czas_ms/Tx_Tau(dzielnik)/1000.0)
  16          #define T1_Rejestr(czas_ms) ((0x000001ul<<t_resol)-Tx_N(czas_ms,pars))
  17          #define T1_Set(czas_ms) TL1 = T1_Rejestr(czas_ms);TH1 = T1_Rejestr(czas_ms)>>8;
  18          
  19          float32_t modulo(float32_t a, float32_t b)
  20          {
  21   1              int16_t result = (int16_t)(a/b);
  22   1              return  a - (float32_t)(result ) *b;
  23   1      }
  24          
  25          typedef struct
  26          {
  27                  double okres;
  28                  double amplituda;
  29                  double offset;
  30                  double t;
  31                  double delta_t;
  32                  double param;
  33          }parametry_sygnalu_t;
  34          
  35          //float32_t pila(parametry_sygnalu_t* syg)
  36          //{
  37          //      
  38          //      return syg->amplituda*(modulo(syg->t, (syg->okres)))/(syg->okres) + syg->offset;
  39          //}
  40          
  41          
  42          float32_t trojkat(parametry_sygnalu_t* syg)
  43          {
  44   1              float32_t time, result;
  45   1              double A = syg->amplituda;
  46   1              double T = syg->okres;
  47   1              double off = syg->offset;
  48   1              double param = syg->param;
  49   1              double del = syg->delta_t;
  50   1              time = modulo(syg->t,T);
  51   1              if(time > param + del)
  52   1              {
  53   2                      result = -A  * 1.0 / (T - param) *(time - param) + A + off;
  54   2              return result;
C51 COMPILER V9.59.0.0   MAIN                                                              12/04/2018 22:45:24 PAGE 2   

  55   2              }
  56   1                      
  57   1              result =   A*time/(param) + off;
  58   1          return result;
  59   1      }
  60          
  61          typedef union
  62          {
  63                  uint16_t wartosc;
  64                  struct
  65                  {
  66                          uint8_t bajt_gorny;
  67                          uint8_t bajt_dolny;
  68                  }slowo;
  69          }probka_t;
  70          
  71          probka_t probka = {0};
  72          float32_t probka_napiecie = 0;
  73          parametry_sygnalu_t pilaParam;
  74          
  75          void timer1() interrupt 3
  76          {
  77   1              T1_Set(OKRES);
  78   1              pilaParam.t += pilaParam.delta_t;
  79   1              if(pilaParam.t > pilaParam.okres)pilaParam.t = pilaParam.delta_t;
  80   1              probka_napiecie = trojkat(&pilaParam);
  81   1              probka_napiecie = (probka_napiecie>ca_Vref)? ca_Vref : probka_napiecie;
  82   1              probka.wartosc = (uint16_t)(probka_napiecie* (1.0 / (1.0 * ca_Vref ))* (float32_t)ca_Maximum_Value);
  83   1              DAC0H = probka.slowo.bajt_gorny;
  84   1              DAC0L = probka.slowo.bajt_dolny;
  85   1      }
  86          
  87          int main()
  88          {
  89   1              
  90   1              ET1 = 1;
  91   1              EA = 1;
  92   1              DACCON = 0x7F;
  93   1              TMOD = 0x10;
  94   1              
  95   1              pilaParam.okres = 4.0;
  96   1              pilaParam.amplituda = 3.0;
  97   1              pilaParam.offset = 1.5;
  98   1              pilaParam.t = 0.0;
  99   1              pilaParam.param = 1.5;
 100   1              pilaParam.delta_t = ((float32_t)OKRES/1000.0);
 101   1              
 102   1              T1_Set(OKRES)
 103   1              TR1 = 1;
 104   1              while(1){};
 105   1              
 106   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    641    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     30      36
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.59.0.0   MAIN                                                              12/04/2018 22:45:24 PAGE 3   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
